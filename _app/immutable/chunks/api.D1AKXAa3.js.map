{"version":3,"file":"api.D1AKXAa3.js","sources":["../../../../../../src/lib/api.ts"],"sourcesContent":["import type { ILoginResponse, IMarkers, IStats, ITree, ITreeUpdatePayload } from '$lib/types';\nimport { isAuthenticated, authState } from '$lib/stores/auth';\nimport { get } from 'svelte/store';\n\ninterface Response<T> {\n\tstatus: number;\n\tdata: T;\n}\n\nexport class ApiClient {\n\tprivate root: string;\n\n\tconstructor() {\n\t\tthis.root = import.meta.env.VITE_API_ROOT;\n\t\tconsole.debug(`[api] Root: ${this.root}`);\n\t}\n\n\tpublic async getTree(id: string): Promise<Response<ITree>> {\n\t\tconsole.debug(`[api] Getting tree ${id}`);\n\t\treturn await this.request('GET', `v1/trees/${id}`);\n\t}\n\n\tpublic async getStats(): Promise<Response<IStats>> {\n\t\tconsole.debug(`[api] Getting stats`);\n\t\treturn await this.request('GET', 'v1/trees/stats');\n\t}\n\n\tpublic async getMarkers(\n\t\tn: number,\n\t\te: number,\n\t\ts: number,\n\t\tw: number\n\t): Promise<Response<IMarkers>> {\n\t\tconst search = new URLSearchParams({\n\t\t\tn: n.toString(),\n\t\t\te: e.toString(),\n\t\t\ts: s.toString(),\n\t\t\tw: w.toString()\n\t\t});\n\n\t\treturn await this.request('GET', 'v1/trees?' + search.toString());\n\t}\n\n\tpublic async loginWithGoogle(token: string): Promise<Response<ILoginResponse>> {\n\t\tconsole.debug('[api] Logging in with Google');\n\n\t\treturn await this.request('POST', 'v2/login/google', {\n\t\t\tbody: JSON.stringify({ token }),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async updateTree(id: string, props: ITreeUpdatePayload): Promise<Response<ITree>> {\n\t\treturn await this.request('PUT', `v1/trees/${id}`, {\n\t\t\tbody: JSON.stringify(props),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t...this.getAuthHeaders()\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async addComment(id: string, message: string): Promise<Response<void>> {\n\t\tconst headers: HeadersInit = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t...this.getAuthHeaders()\n\t\t};\n\n\t\treturn await this.request('POST', `v1/trees/${id}/comments`, {\n\t\t\tbody: JSON.stringify({ message }),\n\t\t\theaders,\n\t\t});\n\t}\n\n\t/**\n\t * Send a raw request to the API.\n\t *\n\t * @docs https://developer.mozilla.org/en-US/docs/Web/API/RequestInit\n\t */\n\tprivate async request<T>(\n\t\tmethod: string,\n\t\tpath: string,\n\t\toptions?: RequestInit\n\t): Promise<Response<T>> {\n\t\tconsole.debug(`[api] Requesting ${method} ${this.root}${path}`);\n\n\t\tconst request = new Request(this.root + path, {\n\t\t\tmethod,\n\t\t\t...options\n\t\t});\n\n\t\tconst response = await fetch(request);\n\t\tconst data = response.status == 202 ? undefined : await response.json();\n\n\t\treturn {\n\t\t\tstatus: response.status,\n\t\t\tdata\n\t\t};\n\t}\n\n\tprivate getAuthHeaders(): HeadersInit {\n\t\tif (get(isAuthenticated)) {\n\t\t\tconst token = get(authState)?.token;\n\n\t\t\tif (token) {\n\t\t\t\treturn {\n\t\t\t\t\tAuthorization: `Bearer ${token}`\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn {};\n\t}\n}\n\nexport const apiClient = new ApiClient();\n"],"names":["ApiClient","__publicField","id","n","s","w","search","token","props","message","headers","method","path","options","request","response","data","get","isAuthenticated","_a","authState","apiClient"],"mappings":"0lBASO,MAAMA,CAAU,CAGtB,aAAc,CAFNC,EAAA,aAGF,KAAA,KAAO,gCACZ,QAAQ,MAAM,eAAe,KAAK,IAAI,EAAE,CAAA,CAGzC,MAAa,QAAQC,EAAsC,CAClD,eAAA,MAAM,sBAAsBA,CAAE,EAAE,EACjC,MAAM,KAAK,QAAQ,MAAO,YAAYA,CAAE,EAAE,CAAA,CAGlD,MAAa,UAAsC,CAClD,eAAQ,MAAM,qBAAqB,EAC5B,MAAM,KAAK,QAAQ,MAAO,gBAAgB,CAAA,CAGlD,MAAa,WACZC,EACA,EACAC,EACAC,EAC8B,CACxB,MAAAC,EAAS,IAAI,gBAAgB,CAClC,EAAGH,EAAE,SAAS,EACd,EAAG,EAAE,SAAS,EACd,EAAGC,EAAE,SAAS,EACd,EAAGC,EAAE,SAAS,CAAA,CACd,EAED,OAAO,MAAM,KAAK,QAAQ,MAAO,YAAcC,EAAO,UAAU,CAAA,CAGjE,MAAa,gBAAgBC,EAAkD,CAC9E,eAAQ,MAAM,8BAA8B,EAErC,MAAM,KAAK,QAAQ,OAAQ,kBAAmB,CACpD,KAAM,KAAK,UAAU,CAAE,MAAAA,EAAO,EAC9B,QAAS,CACR,eAAgB,kBAAA,CACjB,CACA,CAAA,CAGF,MAAa,WAAWL,EAAYM,EAAqD,CACxF,OAAO,MAAM,KAAK,QAAQ,MAAO,YAAYN,CAAE,GAAI,CAClD,KAAM,KAAK,UAAUM,CAAK,EAC1B,QAAS,CACR,eAAgB,mBAChB,GAAG,KAAK,eAAe,CAAA,CACxB,CACA,CAAA,CAGF,MAAa,WAAWN,EAAYO,EAA0C,CAC7E,MAAMC,EAAuB,CAC5B,eAAgB,mBAChB,GAAG,KAAK,eAAe,CACxB,EAEA,OAAO,MAAM,KAAK,QAAQ,OAAQ,YAAYR,CAAE,YAAa,CAC5D,KAAM,KAAK,UAAU,CAAE,QAAAO,EAAS,EAChC,QAAAC,CAAA,CACA,CAAA,CAQF,MAAc,QACbC,EACAC,EACAC,EACuB,CACf,QAAA,MAAM,oBAAoBF,CAAM,IAAI,KAAK,IAAI,GAAGC,CAAI,EAAE,EAE9D,MAAME,EAAU,IAAI,QAAQ,KAAK,KAAOF,EAAM,CAC7C,OAAAD,EACA,GAAGE,CAAA,CACH,EAEKE,EAAW,MAAM,MAAMD,CAAO,EAC9BE,EAAOD,EAAS,QAAU,IAAM,OAAY,MAAMA,EAAS,KAAK,EAE/D,MAAA,CACN,OAAQA,EAAS,OACjB,KAAAC,CACD,CAAA,CAGO,gBAA8B,OACjC,GAAAC,EAAIC,CAAe,EAAG,CACnB,MAAAX,GAAQY,EAAAF,EAAIG,CAAS,IAAb,YAAAD,EAAgB,MAE9B,GAAIZ,EACI,MAAA,CACN,cAAe,UAAUA,CAAK,EAC/B,CACD,CAGD,MAAO,CAAC,CAAA,CAEV,CAEa,MAAAc,EAAY,IAAIrB"}