import{i as T,D as F,l as U,G as M,m as R,d as x,c as A,g as J,e as V,f as z,j as w,u as H,k as q,n as B,p as K,q as j,t as I,r as b,v as k,w as E,x as O,y as $,z as Q,A as W}from"./trace.BqOobQqQ.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="80ebaf4c-e4e7-4e66-b38e-ee58ebbd3353",t._sentryDebugIdIdentifier="sentry-dbid-80ebaf4c-e4e7-4e66-b38e-ee58ebbd3353")}catch{}})();var g;(function(t){t[t.PENDING=0]="PENDING";const s=1;t[t.RESOLVED=s]="RESOLVED";const i=2;t[t.REJECTED=i]="REJECTED"})(g||(g={}));function mt(t){return new p(e=>{e(t)})}function bt(t){return new p((e,s)=>{s(t)})}class p{constructor(e){p.prototype.__init.call(this),p.prototype.__init2.call(this),p.prototype.__init3.call(this),p.prototype.__init4.call(this),this._state=g.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(s){this._reject(s)}}then(e,s){return new p((i,n)=>{this._handlers.push([!1,r=>{if(!e)i(r);else try{i(e(r))}catch(a){n(a)}},r=>{if(!s)n(r);else try{i(s(r))}catch(a){n(a)}}]),this._executeHandlers()})}catch(e){return this.then(s=>s,e)}finally(e){return new p((s,i)=>{let n,r;return this.then(a=>{r=!1,n=a,e&&e()},a=>{r=!0,n=a,e&&e()}).then(()=>{if(r){i(n);return}s(n)})})}__init(){this._resolve=e=>{this._setResult(g.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(g.REJECTED,e)}}__init3(){this._setResult=(e,s)=>{if(this._state===g.PENDING){if(T(s)){s.then(this._resolve,this._reject);return}this._state=e,this._value=s,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===g.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(s=>{s[0]||(this._state===g.RESOLVED&&s[1](this._value),this._state===g.REJECTED&&s[2](this._value),s[0]=!0)})}}}function C(t,e,s,i=0){return new p((n,r)=>{const a=t[i];if(e===null||typeof a!="function")n(e);else{const o=a({...e},s);F&&a.id&&o===null&&U.log(`Event processor "${a.id}" dropped event`),T(o)?o.then(c=>C(t,c,s,i+1).then(n)).then(null,r):C(t,o,s,i+1).then(n).then(null,r)}})}let S,P,y;function X(t){const e=M._sentryDebugIds;if(!e)return{};const s=Object.keys(e);return y&&s.length===P||(P=s.length,y=s.reduce((i,n)=>{S||(S={});const r=S[n];if(r)i[r[0]]=r[1];else{const a=t(n);for(let o=a.length-1;o>=0;o--){const c=a[o],f=c&&c.filename,u=e[n];if(f&&u){i[f]=u,S[n]=[f,u];break}}}return i},{})),y}function Y(t,e){const{fingerprint:s,span:i,breadcrumbs:n,sdkProcessingMetadata:r}=e;Z(t,e),i&&et(t,i),st(t,s),v(t,n),tt(t,r)}function N(t,e){const{extra:s,tags:i,user:n,contexts:r,level:a,sdkProcessingMetadata:o,breadcrumbs:c,fingerprint:f,eventProcessors:u,attachments:d,propagationContext:m,transactionName:h,span:_}=e;D(t,"extra",s),D(t,"tags",i),D(t,"user",n),D(t,"contexts",r),t.sdkProcessingMetadata=R(t.sdkProcessingMetadata,o,2),a&&(t.level=a),h&&(t.transactionName=h),_&&(t.span=_),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),f.length&&(t.fingerprint=[...t.fingerprint,...f]),u.length&&(t.eventProcessors=[...t.eventProcessors,...u]),d.length&&(t.attachments=[...t.attachments,...d]),t.propagationContext={...t.propagationContext,...m}}function D(t,e,s){t[e]=R(t[e],s,1)}function Z(t,e){const{extra:s,tags:i,user:n,contexts:r,level:a,transactionName:o}=e,c=x(s);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});const f=x(i);f&&Object.keys(f).length&&(t.tags={...f,...t.tags});const u=x(n);u&&Object.keys(u).length&&(t.user={...u,...t.user});const d=x(r);d&&Object.keys(d).length&&(t.contexts={...d,...t.contexts}),a&&(t.level=a),o&&t.type!=="transaction"&&(t.transaction=o)}function v(t,e){const s=[...t.breadcrumbs||[],...e];t.breadcrumbs=s.length?s:void 0}function tt(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function et(t,e){t.contexts={trace:A(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:J(e),...t.sdkProcessingMetadata};const s=V(e),i=z(s).description;i&&!t.transaction&&t.type==="transaction"&&(t.transaction=i)}function st(t,e){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function ht(t,e,s,i,n,r){const{normalizeDepth:a=3,normalizeMaxBreadth:o=1e3}=t,c={...e,event_id:e.event_id||s.event_id||H(),timestamp:e.timestamp||q()},f=s.integrations||t.integrations.map(l=>l.name);nt(c,t),rt(c,f),n&&n.emit("applyFrameMetadata",e),e.type===void 0&&it(c,t.stackParser);const u=ct(i,s.captureContext);s.mechanism&&B(c,s.mechanism);const d=n?n.getEventProcessors():[],m=K().getScopeData();if(r){const l=r.getScopeData();N(m,l)}if(u){const l=u.getScopeData();N(m,l)}const h=[...s.attachments||[],...m.attachments];h.length&&(s.attachments=h),Y(c,m);const _=[...d,...m.eventProcessors];return C(_,c,s).then(l=>(l&&at(l),typeof a=="number"&&a>0?ot(l,a,o):l))}function nt(t,e){const{environment:s,release:i,dist:n,maxValueLength:r=250}=e;t.environment=t.environment||s||j,!t.release&&i&&(t.release=i),!t.dist&&n&&(t.dist=n),t.message&&(t.message=I(t.message,r));const a=t.exception&&t.exception.values&&t.exception.values[0];a&&a.value&&(a.value=I(a.value,r));const o=t.request;o&&o.url&&(o.url=I(o.url,r))}function it(t,e){const s=X(e);try{t.exception.values.forEach(i=>{i.stacktrace.frames.forEach(n=>{s&&n.filename&&(n.debug_id=s[n.filename])})})}catch{}}function at(t){const e={};try{t.exception.values.forEach(i=>{i.stacktrace.frames.forEach(n=>{n.debug_id&&(n.abs_path?e[n.abs_path]=n.debug_id:n.filename&&(e[n.filename]=n.debug_id),delete n.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const s=t.debug_meta.images;Object.entries(e).forEach(([i,n])=>{s.push({type:"sourcemap",code_file:i,debug_id:n})})}function rt(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function ot(t,e,s){if(!t)return null;const i={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(n=>({...n,...n.data&&{data:b(n.data,e,s)}}))},...t.user&&{user:b(t.user,e,s)},...t.contexts&&{contexts:b(t.contexts,e,s)},...t.extra&&{extra:b(t.extra,e,s)}};return t.contexts&&t.contexts.trace&&i.contexts&&(i.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(i.contexts.trace.data=b(t.contexts.trace.data,e,s))),t.spans&&(i.spans=t.spans.map(n=>({...n,...n.data&&{data:b(n.data,e,s)}}))),t.contexts&&t.contexts.flags&&i.contexts&&(i.contexts.flags=b(t.contexts.flags,3,s)),i}function ct(t,e){if(!e)return t;const s=t?t.clone():new w;return s.update(e),s}function ut(t){if(t)return ft(t)?{captureContext:t}:pt(t)?{captureContext:t}:t}function ft(t){return t instanceof w||typeof t=="function"}const lt=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function pt(t){return Object.keys(t).some(e=>lt.includes(e))}function Et(t,e){return E().captureException(t,ut(e))}function _t(t,e){return E().captureEvent(t,e)}function xt(){const t=O();return!!t&&t.getOptions().enabled!==!1&&!!t.getTransport()}function St(t){k().addEventProcessor(t)}function yt(t){const e=O(),s=k(),i=E(),{release:n,environment:r=j}=e&&e.getOptions()||{},{userAgent:a}=M.navigator||{},o=$({release:n,environment:r,user:i.getUser()||s.getUser(),...a&&{userAgent:a},...t}),c=s.getSession();return c&&c.status==="ok"&&Q(c,{status:"exited"}),G(),s.setSession(o),i.setSession(o),o}function G(){const t=k(),e=E(),s=e.getSession()||t.getSession();s&&W(s),L(),t.setSession(),e.setSession()}function L(){const t=k(),e=E(),s=O(),i=e.getSession()||t.getSession();i&&s&&s.captureSession(i)}function Dt(t=!1){if(t){G();return}L()}export{p as S,bt as a,Dt as b,Et as c,_t as d,St as e,xt as i,ht as p,mt as r,yt as s};
