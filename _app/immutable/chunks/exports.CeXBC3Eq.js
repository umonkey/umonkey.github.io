import{i as T,D as F,l as U,G as M,m as R,d as x,c as A,g as J,e as V,f as z,j as w,u as H,k as q,n as B,p as K,q as j,t as I,r as h,v as k,w as b,x as O,y as $,z as Q,A as W}from"./trace.BqOobQqQ.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="ce11acca-ab33-4995-87c2-5286a3e3e854",t._sentryDebugIdIdentifier="sentry-dbid-ce11acca-ab33-4995-87c2-5286a3e3e854")}catch{}})();var g;(function(t){t[t.PENDING=0]="PENDING";const s=1;t[t.RESOLVED=s]="RESOLVED";const a=2;t[t.REJECTED=a]="REJECTED"})(g||(g={}));function mt(t){return new p(e=>{e(t)})}function ht(t){return new p((e,s)=>{s(t)})}class p{constructor(e){p.prototype.__init.call(this),p.prototype.__init2.call(this),p.prototype.__init3.call(this),p.prototype.__init4.call(this),this._state=g.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(s){this._reject(s)}}then(e,s){return new p((a,n)=>{this._handlers.push([!1,r=>{if(!e)a(r);else try{a(e(r))}catch(i){n(i)}},r=>{if(!s)n(r);else try{a(s(r))}catch(i){n(i)}}]),this._executeHandlers()})}catch(e){return this.then(s=>s,e)}finally(e){return new p((s,a)=>{let n,r;return this.then(i=>{r=!1,n=i,e&&e()},i=>{r=!0,n=i,e&&e()}).then(()=>{if(r){a(n);return}s(n)})})}__init(){this._resolve=e=>{this._setResult(g.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(g.REJECTED,e)}}__init3(){this._setResult=(e,s)=>{if(this._state===g.PENDING){if(T(s)){s.then(this._resolve,this._reject);return}this._state=e,this._value=s,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===g.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(s=>{s[0]||(this._state===g.RESOLVED&&s[1](this._value),this._state===g.REJECTED&&s[2](this._value),s[0]=!0)})}}}function C(t,e,s,a=0){return new p((n,r)=>{const i=t[a];if(e===null||typeof i!="function")n(e);else{const o=i({...e},s);F&&i.id&&o===null&&U.log(`Event processor "${i.id}" dropped event`),T(o)?o.then(c=>C(t,c,s,a+1).then(n)).then(null,r):C(t,o,s,a+1).then(n).then(null,r)}})}let S,P,y;function X(t){const e=M._sentryDebugIds;if(!e)return{};const s=Object.keys(e);return y&&s.length===P||(P=s.length,y=s.reduce((a,n)=>{S||(S={});const r=S[n];if(r)a[r[0]]=r[1];else{const i=t(n);for(let o=i.length-1;o>=0;o--){const c=i[o],l=c&&c.filename,u=e[n];if(l&&u){a[l]=u,S[n]=[l,u];break}}}return a},{})),y}function Y(t,e){const{fingerprint:s,span:a,breadcrumbs:n,sdkProcessingMetadata:r}=e;Z(t,e),a&&et(t,a),st(t,s),v(t,n),tt(t,r)}function N(t,e){const{extra:s,tags:a,user:n,contexts:r,level:i,sdkProcessingMetadata:o,breadcrumbs:c,fingerprint:l,eventProcessors:u,attachments:d,propagationContext:m,transactionName:E,span:_}=e;D(t,"extra",s),D(t,"tags",a),D(t,"user",n),D(t,"contexts",r),t.sdkProcessingMetadata=R(t.sdkProcessingMetadata,o,2),i&&(t.level=i),E&&(t.transactionName=E),_&&(t.span=_),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),l.length&&(t.fingerprint=[...t.fingerprint,...l]),u.length&&(t.eventProcessors=[...t.eventProcessors,...u]),d.length&&(t.attachments=[...t.attachments,...d]),t.propagationContext={...t.propagationContext,...m}}function D(t,e,s){t[e]=R(t[e],s,1)}function Z(t,e){const{extra:s,tags:a,user:n,contexts:r,level:i,transactionName:o}=e,c=x(s);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});const l=x(a);l&&Object.keys(l).length&&(t.tags={...l,...t.tags});const u=x(n);u&&Object.keys(u).length&&(t.user={...u,...t.user});const d=x(r);d&&Object.keys(d).length&&(t.contexts={...d,...t.contexts}),i&&(t.level=i),o&&t.type!=="transaction"&&(t.transaction=o)}function v(t,e){const s=[...t.breadcrumbs||[],...e];t.breadcrumbs=s.length?s:void 0}function tt(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function et(t,e){t.contexts={trace:A(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:J(e),...t.sdkProcessingMetadata};const s=V(e),a=z(s).description;a&&!t.transaction&&t.type==="transaction"&&(t.transaction=a)}function st(t,e){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function Et(t,e,s,a,n,r){const{normalizeDepth:i=3,normalizeMaxBreadth:o=1e3}=t,c={...e,event_id:e.event_id||s.event_id||H(),timestamp:e.timestamp||q()},l=s.integrations||t.integrations.map(f=>f.name);nt(c,t),rt(c,l),n&&n.emit("applyFrameMetadata",e),e.type===void 0&&at(c,t.stackParser);const u=ct(a,s.captureContext);s.mechanism&&B(c,s.mechanism);const d=n?n.getEventProcessors():[],m=K().getScopeData();if(r){const f=r.getScopeData();N(m,f)}if(u){const f=u.getScopeData();N(m,f)}const E=[...s.attachments||[],...m.attachments];E.length&&(s.attachments=E),Y(c,m);const _=[...d,...m.eventProcessors];return C(_,c,s).then(f=>(f&&it(f),typeof i=="number"&&i>0?ot(f,i,o):f))}function nt(t,e){const{environment:s,release:a,dist:n,maxValueLength:r=250}=e;t.environment=t.environment||s||j,!t.release&&a&&(t.release=a),!t.dist&&n&&(t.dist=n),t.message&&(t.message=I(t.message,r));const i=t.exception&&t.exception.values&&t.exception.values[0];i&&i.value&&(i.value=I(i.value,r));const o=t.request;o&&o.url&&(o.url=I(o.url,r))}function at(t,e){const s=X(e);try{t.exception.values.forEach(a=>{a.stacktrace.frames.forEach(n=>{s&&n.filename&&(n.debug_id=s[n.filename])})})}catch{}}function it(t){const e={};try{t.exception.values.forEach(a=>{a.stacktrace.frames.forEach(n=>{n.debug_id&&(n.abs_path?e[n.abs_path]=n.debug_id:n.filename&&(e[n.filename]=n.debug_id),delete n.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const s=t.debug_meta.images;Object.entries(e).forEach(([a,n])=>{s.push({type:"sourcemap",code_file:a,debug_id:n})})}function rt(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function ot(t,e,s){if(!t)return null;const a={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(n=>({...n,...n.data&&{data:h(n.data,e,s)}}))},...t.user&&{user:h(t.user,e,s)},...t.contexts&&{contexts:h(t.contexts,e,s)},...t.extra&&{extra:h(t.extra,e,s)}};return t.contexts&&t.contexts.trace&&a.contexts&&(a.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(a.contexts.trace.data=h(t.contexts.trace.data,e,s))),t.spans&&(a.spans=t.spans.map(n=>({...n,...n.data&&{data:h(n.data,e,s)}}))),t.contexts&&t.contexts.flags&&a.contexts&&(a.contexts.flags=h(t.contexts.flags,3,s)),a}function ct(t,e){if(!e)return t;const s=t?t.clone():new w;return s.update(e),s}function ut(t){if(t)return lt(t)?{captureContext:t}:pt(t)?{captureContext:t}:t}function lt(t){return t instanceof w||typeof t=="function"}const ft=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function pt(t){return Object.keys(t).some(e=>ft.includes(e))}function bt(t,e){return b().captureException(t,ut(e))}function _t(t,e){return b().captureEvent(t,e)}function xt(){const t=O();return!!t&&t.getOptions().enabled!==!1&&!!t.getTransport()}function St(t){k().addEventProcessor(t)}function yt(t){const e=O(),s=k(),a=b(),{release:n,environment:r=j}=e&&e.getOptions()||{},{userAgent:i}=M.navigator||{},o=$({release:n,environment:r,user:a.getUser()||s.getUser(),...i&&{userAgent:i},...t}),c=s.getSession();return c&&c.status==="ok"&&Q(c,{status:"exited"}),G(),s.setSession(o),a.setSession(o),o}function G(){const t=k(),e=b(),s=e.getSession()||t.getSession();s&&W(s),L(),t.setSession(),e.setSession()}function L(){const t=k(),e=b(),s=O(),a=e.getSession()||t.getSession();a&&s&&s.captureSession(a)}function Dt(t=!1){if(t){G();return}L()}export{p as S,ht as a,Dt as b,bt as c,_t as d,St as e,xt as i,Et as p,mt as r,yt as s};
