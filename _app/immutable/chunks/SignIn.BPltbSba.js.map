{"version":3,"file":"SignIn.BPltbSba.js","sources":["../../../../../../src/lib/utils/auth.ts","../../../../../../src/lib/components/auth/SignIn.svelte"],"sourcesContent":["import { apiClient } from '$lib/api';\nimport { authState } from '$lib/stores/auth';\nimport { toast } from '@zerodevx/svelte-toast';\n\ntype LoginData = {\n\tcredentials: string;\n};\n\nexport const googleCallbackHandler = async (user: LoginData) => {\n\tconst token = user.credential;\n\n\tconst res = await apiClient.loginWithGoogle(token);\n\n\tif (res.status === 200) {\n\t\tauthState.set(res.data);\n\t\tconsole.info(`Logged in as ${res.data.name}`);\n\t} else {\n\t\ttoast.push(`Error ${res.status} getting an authentication token.`);\n\t}\n};\n","<script lang=\"ts\">\n\t/**\n\t * This uses Google's Sign-In HTML interface.\n\t *\n\t * We need to specify the call-back URI for this to work.\n\t */\n\timport { googleCallbackHandler } from '$lib/utils/auth';\n\timport { AUTH_CALLBACK, AUTH_CLIENT_ID } from '$lib/env';\n\n\twindow.onSignIn = googleCallbackHandler;\n\n\tconst onSignIn = () => {\n\t\tconst qs = new URLSearchParams({\n\t\t\tclient_id: AUTH_CLIENT_ID,\n\t\t\tscope: 'openid email profile',\n\t\t\tresponse_type: 'token',\n\t\t\tredirect_uri: AUTH_CALLBACK,\n\t\t\tresponse_mode: 'form_post',\n\t\t\tstate: window.location.href\n\n\t\t\t/*\n\t\t\tgsiwebsdk: 'gis_attributes',\n\t\t\tprompt: 'select_account',\n\t\t\tservice: 'lso',\n\t\t\tflowName: 'GeneralOAuthFlow',\n\t\t\t*/\n\t\t});\n\n\t\tconst url = `https://accounts.google.com/o/oauth2/auth?${qs.toString()}`;\n\t\twindow.location = url;\n\t};\n</script>\n\n<svelte:head>\n\t<script src=\"https://accounts.google.com/gsi/client\" async></script>\n</svelte:head>\n\n<button type=\"button\" on:click={onSignIn}>Sign In with Google</button>\n\n<p>\n\t<a\n\t\thref=\"https://accounts.google.com/o/oauth2/auth?service=lso&o2v=1&ddm=1&flowName=GeneralOAuthFlow\"\n\t\t>Sign In with Google</a\n\t>\n</p>\n\n<div\n\tid=\"g_id_onload\"\n\tdata-client_id={AUTH_CLIENT_ID}\n\tdata-context=\"signin\"\n\tdata-ux_mode=\"redirect\"\n\tdata-redirect_uri={AUTH_CALLBACK}\n\tdata-callback=\"onSignIn\"\n\tdata-itp_support=\"true\"\n\tdata-state=\"HAHA\"\n\tdata-locale=\"en_US\"\n></div>\n\n<div\n\tclass=\"g_id_signin\"\n\tdata-type=\"standard\"\n\tdata-shape=\"rectangular\"\n\tdata-theme=\"outline\"\n\tdata-text=\"signin_with\"\n\tdata-size=\"medium\"\n\tdata-locale=\"en-US\"\n\tdata-logo_alignment=\"left\"\n></div>\n"],"names":["googleCallbackHandler","user","token","res","apiClient","authState","toast","onSignIn","url","AUTH_CLIENT_ID","AUTH_CALLBACK"],"mappings":"izBAQa,MAAAA,EAAwB,MAAOC,GAAoB,CAC/D,MAAMC,EAAQD,EAAK,WAEbE,EAAM,MAAMC,EAAU,gBAAgBF,CAAK,EAE7CC,EAAI,SAAW,KACRE,EAAA,IAAIF,EAAI,IAAI,EACtB,QAAQ,KAAK,gBAAgBA,EAAI,KAAK,IAAI,EAAE,GAE5CG,EAAM,KAAK,SAASH,EAAI,MAAM,mCAAmC,CAEnE,gqBCVC,OAAO,SAAWH,QAEZO,EAAQ,IAAA,OAiBPC,EAAG,iDAhBM,gBAAe,CAC7B,UAAWC,EACX,MAAO,uBACP,cAAe,QACf,aAAcC,EACd,cAAe,YACf,MAAO,OAAO,SAAS,OAUoC,SAAQ,CAAA,GACpE,OAAO,SAAWF,6FAmBHC,CAAc,0BAGXC,CAAa,mBAdDH,CAAQ"}