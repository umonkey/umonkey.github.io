{"version":3,"file":"9.D_Y-DTjp.js","sources":["../../../../../../src/routes/tree/[id=treeid]/comments/+page.ts?sentry-auto-wrap","../../../../../../src/routes/tree/[id=treeid]/comments/+page.ts","../../../../../../src/lib/components/forms/CommentInput.svelte","../../../../../../src/lib/components/forms/CommentForm.svelte","../../../../../../src/lib/components/tree/Comment.svelte","../../../../../../src/routes/tree/[id=treeid]/comments/+page.svelte"],"sourcesContent":["import type { Load } from '@sveltejs/kit';\nimport type { ITree, IComment } from '$lib/types';\nimport { error } from '@sveltejs/kit';\nimport { apiClient } from '$lib/api';\nimport { addUsers } from '$lib/stores/userStore';\n\nconst loadTree = async (id: string): Promise<ITree> => {\n\tconst res = await apiClient.getTree(id);\n\n\tif (res.status !== 200) {\n\t\terror(404);\n\t}\n\n\taddUsers(res.data.users);\n\n\treturn res.data;\n};\n\nconst loadComments = async (id: string): Promise<IComment[]> => {\n\tconst res = await apiClient.getTreeComments(id);\n\n\tif (res.status !== 200) {\n\t\terror(404);\n\t}\n\n\treturn res.data;\n};\n\nexport const load: Load = async ({\n\tparams\n}): Promise<{\n\tid: string;\n\ttree: ITree;\n}> => {\n\tconst treeId = params.id;\n\n\treturn {\n\t\tid: treeId,\n\t\ttree: await loadTree(treeId),\n\t\tcomments: await loadComments(treeId)\n\t};\n};\n","import { wrapLoadWithSentry } from \"@sentry/sveltekit\";import * as userModule from \"/home/hex/src/umonkey/treemap/frontend-v2/src/routes/tree/[id=treeid]/comments/+page.ts?sentry-auto-wrap\";export const load = userModule.load ? wrapLoadWithSentry(userModule.load) : undefined;export * from \"/home/hex/src/umonkey/treemap/frontend-v2/src/routes/tree/[id=treeid]/comments/+page.ts?sentry-auto-wrap\";","<script>\n\timport TextInput from '$lib/components/forms/TextInput.svelte';\n\texport let value = '';\n</script>\n\n<TextInput label=\"Comment\" bind:value multiline={true} hint=\"Some hints or suggested edits.\" />\n","<script>\n\timport { isAuthenticated } from '$lib/stores/auth';\n\n\timport SignIn from '$lib/components/auth/SignIn.svelte';\n\timport CommentInput from '$lib/components/forms/CommentInput.svelte';\n\timport Button from '$lib/components/forms/Button.svelte';\n\n\tconst { onSubmit } = $props();\n\n\tlet message = $state('');\n\n\tconst onButtonClicked = () => {\n\t\tonSubmit(message);\n\t};\n</script>\n\n{#if $isAuthenticated}\n\t<p>Would you like to add a comment?</p>\n\t<CommentInput bind:value={message} />\n\t<div class=\"buttons\">\n\t\t<Button onClick={onButtonClicked} label=\"Submit comment\" disabled={!message} />\n\t</div>\n{:else}\n\t<p>You need to be authenticated to add comments.</p>\n\t<SignIn />\n{/if}\n","<script lang=\"ts\">\n\timport type { IComment } from '$lib/types';\n\timport { getUser } from '$lib/stores/userStore';\n\timport { get } from 'svelte/store';\n\timport { formatDate } from '$lib/utils/strings';\n\n\texport let comment: IComment;\n\n\tconst user = get(getUser)(comment.added_by);\n\tconst date = formatDate(comment.added_at);\n</script>\n\n<div class=\"comment\">\n\t<blockquote>{comment.message}</blockquote>\n\t<div class=\"meta\">{date} Â· {user.name}</div>\n</div>\n\n<style>\n\tblockquote {\n\t\tborder-left: solid 4px var(--sep-color);\n\t\tmargin: var(--gap) 0;\n\t\tpadding: var(--gap);\n\t}\n\n\t.meta {\n\t\tfont-size: 0.8em;\n\t\topacity: 0.75;\n\t}\n\n\t.comment {\n\t\tborder-bottom: solid 1px var(--sep-color);\n\t\tpadding-bottom: var(--gap);\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { apiClient } from '$lib/api';\n\timport { goto } from '$app/navigation';\n\timport { routes } from '$lib/routes';\n\timport { toast } from '@zerodevx/svelte-toast';\n\n\timport Header from '$lib/components/tree/Header.svelte';\n\timport Tabs from '$lib/components/tree/Tabs.svelte';\n\timport Title from '$lib/components/tree/Title.svelte';\n\timport TreeMenu from '$lib/components/tree/Menu.svelte';\n\timport CommentForm from '$lib/components/forms/CommentForm.svelte';\n\timport Comment from '$lib/components/tree/Comment.svelte';\n\n\tconst { data } = $props();\n\tconst tree = data.tree;\n\tconst comments = data.comments;\n\n\tconst onSubmit = (message: string) => {\n\t\tapiClient\n\t\t\t.addComment(tree.id, message)\n\t\t\t.then((res) => {\n\t\t\t\tif (res.status >= 200 && res.status < 300) {\n\t\t\t\t\ttoast.push('Comment added.');\n\t\t\t\t\tgoto(routes.treeDetails(tree.id));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.info(`Error ${res.status} adding a comment.`);\n\t\t\t\t\ttoast.push('Error adding comment.');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error('Exception while adding a comment.', e);\n\t\t\t\ttoast.push('Error adding comment.');\n\t\t\t});\n\t};\n</script>\n\n<svelte:head>\n\t<title>{tree.species} - Details</title>\n</svelte:head>\n\n<Header title=\"Tree\" />\n<Title title={tree.species} />\n<Tabs tree={tree.id} active=\"comments\" />\n<TreeMenu id={tree.id} />\n\n<div class=\"container\">\n\t{#if comments.length > 0}\n\t\t{#each comments as comment}\n\t\t\t<Comment {comment} />\n\t\t{/each}\n\t{:else}\n\t\t<p>No comments for this tree yet.</p>\n\t{/if}\n\n\t<CommentForm {onSubmit} />\n</div>\n\n<style>\n\t.container {\n\t\tpadding: 0 var(--gap);\n\t}\n</style>\n"],"names":["loadTree","id","res","apiClient","error","addUsers","loadComments","load","params","treeId","userModule.load","wrapLoadWithSentry","value","message","onButtonClicked","$.proxy","$$value","$isAuthenticated","$$render","consequent","alternate","comment","$.prop","$$props","user","get","getUser","date","formatDate","$.set_text","text","tree","comments","onSubmit","toast","goto","routes","e","$.template_effect","$.document","$.each","node_5"],"mappings":"s7CAMA,MAAMA,GAAW,MAAOC,GAA+B,CACtD,MAAMC,EAAM,MAAMC,EAAU,QAAQF,CAAE,EAElC,OAAAC,EAAI,SAAW,KAClBE,EAAM,GAAG,EAGDC,EAAAH,EAAI,KAAK,KAAK,EAEhBA,EAAI,IACZ,EAEMI,GAAe,MAAOL,GAAoC,CAC/D,MAAMC,EAAM,MAAMC,EAAU,gBAAgBF,CAAE,EAE1C,OAAAC,EAAI,SAAW,KAClBE,EAAM,GAAG,EAGHF,EAAI,IACZ,EAEaK,EAAa,MAAO,CAChC,OAAAC,CACD,IAGM,CACL,MAAMC,EAASD,EAAO,GAEf,MAAA,CACN,GAAIC,EACJ,KAAM,MAAMT,GAASS,CAAM,EAC3B,SAAU,MAAMH,GAAaG,CAAM,CACpC,CACD,ECzC2MF,GAAOG,EAAkBC,EAAmBD,CAAe,EAAI,8HCE9P,IAAAE,iBAAQ,EAAE,kCAG2B,oUCI5C,IAAAC,IAAiB,EAAE,QAEjBC,EAAe,IAAA,cACXD,CAAO,CAAA,iFAMSA,CAAO,kBAAPA,EAAOE,GAAAC,CAAA,CAAA,oCAEoCH,CAAO,CAAA,gBAA1DC,0HAJdG,EAAgB,EAAAC,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,0LCVTC,EAAiBC,EAAAC,EAAA,UAAA,CAAA,EAEtB,MAAAC,EAAOC,EAAIC,CAAO,EAAEL,EAAO,EAAC,QAAQ,EACpCM,EAAOC,GAAWP,EAAO,EAAC,QAAQ,4EAI3BQ,EAAAC,EAAAT,IAAQ,OAAO,SACTM,GAAI,EAAA,MAAKH,EAAK,MAAI,EAAA,EAAA,wKCA/B,MAAAO,SAAY,KACZC,SAAgB,SAEhBC,EAAYpB,GAAe,CAChCV,EACE,WAAW4B,EAAK,GAAIlB,CAAO,EAC3B,KAAMX,GAAG,CACLA,EAAI,QAAU,KAAOA,EAAI,OAAS,KACrCgC,EAAM,KAAK,gBAAgB,EAC3BC,EAAKC,EAAO,YAAYL,EAAK,EAAE,CAAA,IAE/B,QAAQ,KAAc,SAAA7B,EAAI,MAAM,oBAAA,EAChCgC,EAAM,KAAK,uBAAuB,EAGnC,CAAA,EAAA,MAAOG,GAAC,CACR,QAAQ,MAAM,oCAAqCA,CAAC,EACpDH,EAAM,KAAK,uBAAuB,sBAM7BI,EAAA,IAAAC,EAAA,MAAA,GAAAR,EAAK,SAAO,EAAA,YAAA,mEAIP,OAAAA,EAAK,yCACP,OAAAA,EAAK,oDACH,OAAAA,EAAK,sDAIVS,EAAAC,EAAA,GAAA,IAAAT,OAAYX,IAAO,+EADtBW,EAAS,OAAS,EAACd,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA"}