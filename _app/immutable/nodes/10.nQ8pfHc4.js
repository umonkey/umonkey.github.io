import{g as ue}from"../chunks/entry.Dod8blnn.js";import{a as P,w as ve}from"../chunks/api.Bi0sabdr.js";import{e as Z}from"../chunks/index.DZ2rep82.js";import"../chunks/disclose-version.CUXYTn5h.js";import{e as ne,T as A,P as m,R as f,U as N,O as l,t as O,ab as o,a8 as b,aM as k,Q as ce,aQ as de,N as ee,aD as pe}from"../chunks/index.z6kBXauZ.js";import{h as fe}from"../chunks/svelte-head.DEEuaWfR.js";import{a as M,t as x}from"../chunks/template.B-dqGRda.js";import{i as me,p as S,a as s}from"../chunks/props.pyAFSr6r.js";import{r as _e}from"../chunks/routes.CGGklALb.js";import"../chunks/legacy.DB9raPp5.js";import{t as te}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.CMSZquah.js";import{A as ge}from"../chunks/AuthWrapper.D-nUNJop.js";import{T as Y,H as he,B as ae}from"../chunks/Button.D4riBBXM.js";import{H as be}from"../chunks/Header.DWY7kv7h.js";import{i as L,b as K}from"../chunks/store.D4VmzRFx.js";import{r as oe,a as ye}from"../chunks/attributes.B19BiYAU.js";import{l as ke,d as le}from"../chunks/events.D7MPWNQN.js";import{M as we}from"../chunks/MapIcon.CziCv3RQ.js";import{M as Ie}from"../chunks/Map.Bq14yXKN.js";import{e as Me,i as Se}from"../chunks/each.4NNzQdmB.js";import{t as xe}from"../chunks/class.Ci0NJvbd.js";import{b as je}from"../chunks/input.BtxBt0iG.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="3f391db8-fd38-4c7f-981e-8b7657865349",t._sentryDebugIdIdentifier="sentry-dbid-3f391db8-fd38-4c7f-981e-8b7657865349")}catch{}})();function ie(t,e,a){if(t.multiple)return Te(t,e);for(var r of t.options){var n=E(r);if(me(n,e)){r.selected=!0;return}}(!a||e!==void 0)&&(t.selectedIndex=-1)}function Ce(t,e){ne(()=>{var a=new MutationObserver(()=>{var r=t.__value;ie(t,r)});return a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function qe(t,e,a=e){var r=!0;ke(t,"change",n=>{var i=n?"[selected]":":checked",u;if(t.multiple)u=[].map.call(t.querySelectorAll(i),E);else{var v=t.querySelector(i)??t.querySelector("option:not([disabled])");u=v&&E(v)}a(u)}),ne(()=>{var n=e();if(ie(t,n,r),r&&n===void 0){var i=t.querySelector(":checked");i!==null&&(n=E(i),a(n))}t.__value=n,r=!1}),Ce(t)}function Te(t,e){for(var a of t.options)a.selected=~e.indexOf(E(a))}function E(t){return"__value"in t?t.__value:t.value}const re=async({params:t})=>{const e=t.id;e||Z(404);const a=await P.getTree(e);return a.status!==200&&Z(404),{id:e,tree:a.data}},Ee=re?ve(re):void 0,wt=Object.freeze(Object.defineProperty({__proto__:null,load:Ee},Symbol.toStringTag,{value:"Module"}));function Oe(t,e){let a=S(e,"value",12,"");Y(t,{label:"Canopy diameter, m",type:"number",help:"https://github.com/KanachYerevan/kb/wiki/Measuring-tree-crown",get value(){return a()},set value(r){a(r)},$$legacy:!0})}function Ye(t,e){let a=S(e,"value",12,"");Y(t,{label:"Trunk circumference, cm",type:"number",hint:"Measure at chest level, aka 120 cm from the ground.",help:"https://github.com/KanachYerevan/kb/wiki/Measuring-trunk-circumference",get value(){return a()},set value(r){a(r)},$$legacy:!0})}function De(t,e){let a=S(e,"value",12,"");Y(t,{label:"Height, m",type:"number",help:"https://github.com/KanachYerevan/kb/wiki/Measuring-tree-height",get value(){return a()},set value(r){a(r)},$$legacy:!0})}var He=x('<div class="mapContainer svelte-x8ryfb"><!></div>');function Le(t,e){A(e,!0);const a=i=>{e.onMove([i.lat,i.lng])};var r=He(),n=m(r);Ie(n,{get center(){return e.center},zoom:19,crosshair:!0,onMove:a}),f(r),M(t,r),N()}const Ke=(t,e)=>{b(e,!o(e))};var Pe=x('<div class="hint"> </div>'),Ae=x('<div class="input"><label><span>Location</span> <div class="group svelte-pe0fn"><input type="text"> <button type="button" class="svelte-pe0fn"><!></button></div> <!></label> <!></div>');function Ne(t,e){let a=S(e,"value",31,()=>s([])),r=S(e,"hint",3,void 0),n=k(!1);const i=p=>`${p[0]}, ${p[1]}`,u=p=>{a(p)};var v=Ae(),d=m(v),g=l(m(d),2),h=m(g);oe(h),O(()=>ye(h,i(a())));var c=l(h,2);c.__click=[Ke,n];var w=m(c);we(w),f(c),f(g);var q=l(g,2);{var j=p=>{Le(p,{get center(){return a()},onMove:u})};L(q,p=>{o(n)&&p(j)})}f(d);var I=l(d,2);{var T=p=>{var C=Pe(),D=m(C,!0);f(C),O(()=>K(D,r())),M(p,C)};L(I,p=>{r()&&p(T)})}f(v),M(t,v)}le(["click"]);function ze(t,e){let a=S(e,"value",12,"");Y(t,{label:"Description",multiline:!0,hint:"Add some notable details that could help visitors understand the importance of this tree.",get value(){return a()},set value(r){a(r)},$$legacy:!0})}const Be=(t,e,a)=>{const r=t.target;P.searchSpecies(r.value).then(n=>{n.status===200&&(b(e,s(n.data)),b(a,o(e).length>0))})},Fe=(t,e)=>{setTimeout(()=>{b(e,!1)},200)};var Qe=(t,e,a)=>e(o(a).name),Ue=x('<li class="svelte-1j0o0wm"> <small class="svelte-1j0o0wm"> </small></li>'),We=x('<ul class="options svelte-1j0o0wm"></ul>'),Re=x('<div class="input"><label class="svelte-1j0o0wm"><span class="svelte-1j0o0wm">Species</span> <input type="text" autocomplete="off" placeholder="Type a latin or local name" class="svelte-1j0o0wm"> <!></label> <div class="hint svelte-1j0o0wm">Enter the latin genus of the tree.</div></div>');function $e(t,e){A(e,!0);let a=S(e,"value",15),r=k(s([])),n=k(!1);const i=c=>{b(n,!1),a(c)};var u=Re(),v=m(u),d=l(m(v),2);oe(d),d.__input=[Be,r,n],d.__focusout=[Fe,n];var g=l(d,2);{var h=c=>{var w=We();Me(w,21,()=>o(r),Se,(q,j)=>{var I=Ue();I.__click=[Qe,i,j];var T=m(I),p=l(T),C=m(p);f(p),f(I),O(()=>{K(T,`${o(j).name??""} `),K(C,`~ ${o(j).local??""}`)}),M(q,I)}),f(w),M(c,w)};L(g,c=>{o(n)>0&&c(h)})}f(v),ce(2),f(u),O(()=>xe(v,"drop",o(n))),je(d,a),M(t,u),N()}le(["input","focusout","click"]);var Ge=x('<div class="input"><label class="svelte-1ogmqdw"><span class="svelte-1ogmqdw">State</span> <div class="group svelte-1ogmqdw"><select class="svelte-1ogmqdw"><option>(unknown)</option><option>healthy</option><option>sick</option><option>deformed</option><option>gone</option><option>stomp</option></select> <!></div></label></div>');function Je(t,e){let a=S(e,"value",12,"");var r=Ge(),n=m(r),i=l(m(n),2),u=m(i);O(()=>{a(),de(()=>{})});var v=m(u);v.value=((v.__value="")==null,"");var d=l(v);d.value=(d.__value="healthy")==null?"":"healthy";var g=l(d);g.value=(g.__value="sick")==null?"":"sick";var h=l(g);h.value=(h.__value="deformed")==null?"":"deformed";var c=l(h);c.value=(c.__value="gone")==null?"":"gone";var w=l(c);w.value=(w.__value="stomp")==null?"":"stomp",f(u);var q=l(u,2);he(q,{help:"https://github.com/KanachYerevan/kb/wiki/Understanding-tree-state"}),f(i),f(n),f(r),qe(u,a),M(t,r)}function Ve(t,e){let a=S(e,"value",15,"");Y(t,{label:"Year planted",type:"number",help:"https://github.com/KanachYerevan/kb/wiki/Year-Planted",get value(){return a()},set value(r){a(r)}})}var Xe=x('<!> <!> <!> <!> <!> <!> <!> <!> <div class="buttons"><!> <!></div>',1),Ze=x('<!> <div class="form svelte-1jizvdx"><!></div>',1);function It(t,e){var C,D,z;A(e,!0);const a=e.data.id;let r=k(s(e.data.tree.species??"")),n=k(s(((C=e.data.tree.height)==null?void 0:C.toString())??"0")),i=k(s(((D=e.data.tree.diameter)==null?void 0:D.toString())??"0")),u=k(s(((z=e.data.tree.circumference)==null?void 0:z.toString())??"0")),v=k(s(e.data.tree.state??"")),d=k(s(e.data.tree.notes??"")),g=k(s([e.data.tree.lat,e.data.tree.lon])),h=k(s(e.data.tree.year??""));const c=y=>{if(y===""||y==="0")return null;const H=parseFloat(y);return isNaN(H)?null:H},w=()=>{P.updateTree(a,{species:o(r),height:c(o(n)),diameter:c(o(i)),circumference:c(o(u)),state:o(v),notes:o(d),lat:o(g)[0],lon:o(g)[1],year:c(o(h))}).then(y=>{y.status>=200&&y.status<400?ue(_e.treeDetails(a)):(console.error(`Error ${y.status} updating tree.`),te.push("Error updating tree."))}).catch(y=>{console.error(`Error updating tree: ${y}.`),te.push("Error updating tree.")})},q=()=>{history.back()};var j=Ze();fe(y=>{pe.title="Edit tree"});var I=ee(j);be(I,{title:"Edit tree"});var T=l(I,2),p=m(T);ge(p,{children:(y,H)=>{var B=Xe(),F=ee(B);$e(F,{get value(){return o(r)},set value(_){b(r,s(_))}});var Q=l(F,2);De(Q,{get value(){return o(n)},set value(_){b(n,s(_))}});var U=l(Q,2);Oe(U,{get value(){return o(i)},set value(_){b(i,s(_))}});var W=l(U,2);Ye(W,{get value(){return o(u)},set value(_){b(u,s(_))}});var R=l(W,2);Je(R,{get value(){return o(v)},set value(_){b(v,s(_))}});var $=l(R,2);Ve($,{get value(){return o(h)},set value(_){b(h,s(_))}});var G=l($,2);Ne(G,{get value(){return o(g)},set value(_){b(g,s(_))}});var J=l(G,2);ze(J,{get value(){return o(d)},set value(_){b(d,s(_))}});var V=l(J,2),X=m(V);ae(X,{type:"submit",label:"Save changes",onClick:w});var se=l(X,2);ae(se,{type:"cancel",label:"Cancel",onClick:q}),f(V),M(y,B)},$$slots:{default:!0}}),f(T),M(t,j),N()}export{It as component,wt as universal};
