import{g as ie}from"../chunks/entry.H2d7xo9k.js";import{a as q,w as ue}from"../chunks/api.YGaO-OxF.js";import{e as U}from"../chunks/index.CFGGz30R.js";import"../chunks/disclose-version.BuaYvhyZ.js";import{e as te,O as n,P as f,t as O,ab as o,a8 as b,aM as h,Q as p,R as ae,T as re,$ as ve,aQ as de,a2 as V,N as X,aB as ce}from"../chunks/index.CbWQdyPD.js";import{h as pe}from"../chunks/svelte-head.DlRxUE2U.js";import{a as k,t as w}from"../chunks/template.FARQGre2.js";import{i as fe,p as j,a as c}from"../chunks/props.ChXuGk-T.js";import{r as me}from"../chunks/routes.DJaOq88p.js";import"../chunks/legacy.Cuu4uX5Q.js";import{t as Y}from"../chunks/SvelteToast.svelte_svelte_type_style_lang.B0Rm7KC1.js";import{T as $,B as Z}from"../chunks/Button.RZPKJHjX.js";import{A as _e}from"../chunks/AuthWrapper.OjPq9P60.js";import{H as ge}from"../chunks/Header.B2iSxPiH.js";import{i as D,b as L}from"../chunks/store.62LGNKp5.js";import{r as le,a as be}from"../chunks/attributes.Bszi7fWb.js";import{l as he,d as oe}from"../chunks/events.Dh_5afs_.js";import{M as ye}from"../chunks/MapIcon.HRrGhZ_p.js";import{e as ke,i as we}from"../chunks/each.8C-LENRi.js";import{t as Ie}from"../chunks/class.Xtb3dM_A.js";import{b as Se}from"../chunks/input.d3faN642.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4c64d2bd-5e2d-40e0-bb8e-23ff4e33a87b",e._sentryDebugIdIdentifier="sentry-dbid-4c64d2bd-5e2d-40e0-bb8e-23ff4e33a87b")}catch{}})();function ne(e,t,a){if(e.multiple)return Te(e,t);for(var r of e.options){var l=M(r);if(fe(l,t)){r.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function xe(e,t){te(()=>{var a=new MutationObserver(()=>{var r=e.__value;ne(e,r)});return a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function je(e,t,a=t){var r=!0;he(e,"change",l=>{var s=l?"[selected]":":checked",i;if(e.multiple)i=[].map.call(e.querySelectorAll(s),M);else{var u=e.querySelector(s)??e.querySelector("option:not([disabled])");i=u&&M(u)}a(i)}),te(()=>{var l=t();if(ne(e,l,r),r&&l===void 0){var s=e.querySelector(":checked");s!==null&&(l=M(s),a(l))}e.__value=l,r=!1}),xe(e)}function Te(e,t){for(var a of e.options)a.selected=~t.indexOf(M(a))}function M(e){return"__value"in e?e.__value:e.value}const ee=async({params:e})=>{const t=e.id;t||U(404);const a=await q.getTree(t);return a.status!==200&&U(404),{id:t,tree:a.data}},Ce=ee?ue(ee):void 0,ht=Object.freeze(Object.defineProperty({__proto__:null,load:Ce},Symbol.toStringTag,{value:"Module"}));function Ee(e,t){let a=j(t,"value",12,"");$(e,{label:"Address",hint:"This is normally set automatically when adding a tree, but you can edit.",get value(){return a()},set value(r){a(r)},$$legacy:!0})}function Me(e,t){let a=j(t,"value",12,"");$(e,{label:"Canopy diameter, m",type:"number",get value(){return a()},set value(r){a(r)},$$legacy:!0})}function Oe(e,t){let a=j(t,"value",12,"");$(e,{label:"Trunk circumference, cm",type:"number",hint:"Measure at chest level, aka 120 cm from the ground.",get value(){return a()},set value(r){a(r)},$$legacy:!0})}function $e(e,t){let a=j(t,"value",12,"");$(e,{label:"Height, m",type:"number",get value(){return a()},set value(r){a(r)},$$legacy:!0})}var Ae=w('<div class="svelte-fgp7zl"></div>');function De(e){var t=Ae();k(e,t)}const Le=(e,t)=>{b(t,!o(t))};var qe=w('<div class="hint"> </div>'),Fe=w('<div class="input"><label><span>Location</span> <div class="group svelte-134f22m"><input type="text"> <button type="button" class="svelte-134f22m"><!></button></div> <!></label> <!></div>');function He(e,t){const a=j(t,"hint",3,void 0);let r=h(!1);const l=d=>d.join(", ");var s=Fe(),i=f(s),u=n(f(i),2),v=f(u);le(v),O(()=>be(v,l(t.value)));var m=n(v,2);m.__click=[Le,r];var y=f(m);ye(y),p(m),p(u);var g=n(u,2);{var T=d=>{De(d)};D(g,d=>{o(r)&&d(T)})}p(i);var E=n(i,2);{var I=d=>{var S=qe(),C=f(S,!0);p(S),O(()=>L(C,a())),k(d,S)};D(E,d=>{a()&&d(I)})}p(s),k(e,s)}oe(["click"]);function Pe(e,t){let a=j(t,"value",12,"");$(e,{label:"Description",multiline:!0,hint:"Add some notable details that could help visitors understand the importance of this tree.",get value(){return a()},set value(r){a(r)},$$legacy:!0})}const ze=(e,t,a)=>{const r=e.target;q.searchSpecies(r.value).then(l=>{l.status===200&&(b(t,c(l.data)),b(a,o(t).length>0))})},Be=(e,t)=>{setTimeout(()=>{b(t,!1)},200)};var Ne=(e,t,a)=>t(o(a).name),Qe=w('<li class="svelte-1j0o0wm"> <small class="svelte-1j0o0wm"> </small></li>'),We=w('<ul class="options svelte-1j0o0wm"></ul>'),Re=w('<div class="input"><label class="svelte-1j0o0wm"><span class="svelte-1j0o0wm">Species</span> <input type="text" autocomplete="off" placeholder="Type a latin or local name" class="svelte-1j0o0wm"> <!></label> <div class="hint svelte-1j0o0wm">Enter the latin genus of the tree.</div></div>');function Ge(e,t){ae(t,!0);let a=j(t,"value",15),r=h(c([])),l=h(!1);const s=g=>{b(l,!1),a(g)};var i=Re(),u=f(i),v=n(f(u),2);le(v),v.__input=[ze,r,l],v.__focusout=[Be,l];var m=n(v,2);{var y=g=>{var T=We();ke(T,21,()=>o(r),we,(E,I)=>{var d=Qe();d.__click=[Ne,s,I];var S=f(d),C=n(S),A=f(C);p(C),p(d),O(()=>{L(S,`${o(I).name??""} `),L(A,`~ ${o(I).local??""}`)}),k(E,d)}),p(T),k(g,T)};D(m,g=>{o(l)>0&&g(y)})}p(u),ve(2),p(i),O(()=>Ie(u,"drop",o(l))),Se(v,a),k(e,i),re()}oe(["input","focusout","click"]);var Je=w('<div class="input"><label class="svelte-a4sar6"><span class="svelte-a4sar6">State</span> <select class="svelte-a4sar6"><option>(unknown)</option><option>healthy</option><option>sick</option><option>deformed</option><option>gone</option><option>stomp</option></select></label></div>');function Ke(e,t){let a=j(t,"value",12,"");var r=Je(),l=f(r),s=n(f(l),2);O(()=>{a(),de(()=>{})});var i=f(s);i.value=((i.__value="")==null,"");var u=n(i);u.value=(u.__value="healthy")==null?"":"healthy";var v=n(u);v.value=(v.__value="sick")==null?"":"sick";var m=n(v);m.value=(m.__value="deformed")==null?"":"deformed";var y=n(m);y.value=(y.__value="gone")==null?"":"gone";var g=n(y);g.value=(g.__value="stomp")==null?"":"stomp",p(s),p(l),p(r),je(s,a),k(e,r)}var Ue=w('<!> <!> <!> <!> <!> <!> <!> <!> <div class="buttons"><!> <!></div>',1),Ve=w('<!> <div class="form svelte-1jizvdx"><!></div>',1);function yt(e,t){var C,A,F;ae(t,!0);const a=t.data.id;let r=h(c(t.data.tree.species??"")),l=h(c(((C=t.data.tree.height)==null?void 0:C.toString())??"0")),s=h(c(((A=t.data.tree.diameter)==null?void 0:A.toString())??"0")),i=h(c(((F=t.data.tree.circumference)==null?void 0:F.toString())??"0")),u=h(c(t.data.tree.state??"")),v=h(""),m=h(c(t.data.tree.notes??"")),y=c([t.data.tree.lat,t.data.tree.lon]);V(()=>{console.debug("Species changed to:",o(r))}),V(()=>{console.debug("Address changed to:",o(v))});const g=()=>{q.updateTree(a,{species:o(r),height:parseFloat(o(l)),diameter:parseFloat(o(s)),circumference:parseFloat(o(i)),state:o(u),address:o(v),notes:o(m)}).then(x=>{x.status>=200&&x.status<400?ie(me.treeDetails(a)):(console.error(`Error ${x.status} updating tree.`),Y.push("Error updating tree."))}).catch(x=>{console.error(`Error updating tree: ${x}.`),Y.push("Error updating tree.")})},T=()=>{history.back()};var E=Ve();pe(x=>{ce.title="Edit tree"});var I=X(E);ge(I,{title:"Edit tree"});var d=n(I,2),S=f(d);_e(S,{children:(x,Xe)=>{var H=Ue(),P=X(H);Ge(P,{get value(){return o(r)},set value(_){b(r,c(_))}});var z=n(P,2);$e(z,{get value(){return o(l)},set value(_){b(l,c(_))}});var B=n(z,2);Me(B,{get value(){return o(s)},set value(_){b(s,c(_))}});var N=n(B,2);Oe(N,{get value(){return o(i)},set value(_){b(i,c(_))}});var Q=n(N,2);Ke(Q,{get value(){return o(u)},set value(_){b(u,c(_))}});var W=n(Q,2);He(W,{get value(){return y}});var R=n(W,2);Ee(R,{get value(){return o(v)},set value(_){b(v,c(_))}});var G=n(R,2);Pe(G,{get value(){return o(m)},set value(_){b(m,c(_))}});var J=n(G,2),K=f(J);Z(K,{type:"submit",label:"Save changes",onClick:g});var se=n(K,2);Z(se,{type:"cancel",label:"Cancel",onClick:T}),p(J),k(x,H)},$$slots:{default:!0}}),p(d),k(e,E),re()}export{yt as component,ht as universal};
