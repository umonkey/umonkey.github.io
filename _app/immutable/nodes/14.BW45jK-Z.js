import"../chunks/entry.OImHg3gI.js";import{w as q}from"../chunks/load.BtWDkKTt.js";import"../chunks/disclose-version.vMxi1LYk.js";import{ab as _,ac as B,ad as L,T as H,t as b,U as P,a6 as U,aL as J,P as g,O as d,ah as Q,R as u,N as M,aK as V}from"../chunks/index.D2QBpCmX.js";import{s as X,a as F,b as Z}from"../chunks/store.DvNMo4ai.js";import{i as O}from"../chunks/if.DIZMYV78.js";import{e as ee,i as te}from"../chunks/each.DJDUisb8.js";import{a as m,t as v}from"../chunks/template.AFpqK3Ql.js";import{h as ae}from"../chunks/svelte-head.CYodAuYg.js";import{s as oe}from"../chunks/attributes.fKJ51INB.js";import{d as T}from"../chunks/events.Bo0QLjtm.js";import{a as se}from"../chunks/api.DTgSd7Mi.js";import{H as le}from"../chunks/Header.CvSZHzu2.js";import"../chunks/legacy.B__8PB0f.js";import{b as ie}from"../chunks/this.BANWf-A6.js";import{i as re}from"../chunks/lifecycle.y8OLtr5S.js";import{p as R}from"../chunks/props.Cz6Hg2a0.js";import{C as ne}from"../chunks/CloseIcon.Bery5fQo.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="12755677-d8f2-4b03-b9c7-6b66646497bb",e._sentryDebugIdIdentifier="sentry-dbid-12755677-d8f2-4b03-b9c7-6b66646497bb")}catch{}})();const z=({params:e})=>({id:e.id}),de=z?q(z):void 0,Ge=Object.freeze(Object.defineProperty({__proto__:null,load:de},Symbol.toStringTag,{value:"Module"})),l=B({files:[],uploading:!1,progress:0,message:null}),pe=_(l,e=>e.files),ce=_(l,e=>e.uploading);_(l,e=>e.progress);const ue=_(l,e=>e.message),fe=async(e,a)=>{await se.uploadFile(a,e),console.info(`[upload] Uploaded ${e.name}.`)},ge=async e=>{const a=L(l).files.length,i=L(l).files,p=[],f=i.length;let r=0;console.debug(`[upload] Going to upload ${a} files for tree ${e}.`),l.update(t=>(t.message=null,t));try{l.update(t=>(t.uploading=!0,t));for(const t of i){console.debug(`[upload] Uploading ${t.name}...`);try{await fe(t,e)}catch(n){console.error(`[upload] Failed to upload ${t.name}: ${n}`),p.push(t)}finally{r++,l.update(n=>(n.progress=r/f*100,n))}}}finally{console.debug("[upload] Finished."),l.update(t=>(t.files=p,t.uploading=!1,t))}l.update(t=>(t.message="Finished uploading all photos. They will show up on the tree page shortly. You can upload more files if needed.",t))},me=(e,a)=>{U(a).click()},ve=(e,a)=>{e.target.files.length>0&&a()(e.target.files)};var be=v('<div><button type="button" class="button">Add photos</button> <input type="file" accept="image/jpeg" multiple class="svelte-jeejfu"></div>');function _e(e,a){H(a,!1);let i=J(),p=R(a,"disabled",8,!1),f=R(a,"onFileSelected",8);re();var r=be(),t=g(r);t.__click=[me,i];var n=d(t,2);n.__change=[ve,f],ie(n,h=>Q(i,h),()=>U(i)),u(r),b(()=>t.disabled=p()),m(e,r),P()}T(["click","change"]);var he=v("<p> </p>"),ye=(e,a)=>ge(a),we=v('<div class="preview svelte-auwpl1"><img alt="preview" class="svelte-auwpl1"> <button class="close svelte-auwpl1"><!></button></div>'),$e=v('<h2>Selected photos:</h2> <div class="grid svelte-auwpl1"></div>',1),Fe=v('<!> <div class="form svelte-auwpl1"><p>Here you can upload multiple photos of this tree.</p> <!> <div class="buttons"><!> <button class="button" type="button">Upload</button></div> <!></div>',1);function Ke(e,a){H(a,!0);const i=X(),p=()=>F(ue,"$uploadMessage",i),f=()=>F(ce,"$isUploading",i),r=()=>F(pe,"$storedFiles",i),t=a.data.id,n=s=>{l.update(o=>(o.files=[...o.files,...s],o))},h=s=>{console.debug(`Removing file at index ${s}.`),l.update(o=>{const c=[...o.files];return c.splice(s,1),o.files=c,o})};var k=Fe();ae(s=>{V.title="Upload tree photos"});var S=M(k);le(S,{title:"Upload photos"});var I=d(S,2),j=d(g(I),2);{var A=s=>{var o=he(),c=g(o,!0);u(o),b(()=>Z(c,p())),m(s,o)};O(j,s=>{p()&&s(A)})}var y=d(j,2),C=g(y);_e(C,{onFileSelected:n,get disabled(){return f()}});var x=d(C,2);x.__click=[ye,t],u(y);var E=d(y,2);{var G=s=>{var o=$e(),c=d(M(o),2);ee(c,5,r,te,(K,N,W)=>{var w=we(),D=g(w);b(()=>oe(D,"src",URL.createObjectURL(U(N))));var $=d(D,2);$.__click=()=>h(W);var Y=g($);ne(Y,{width:24,height:24}),u($),u(w),m(K,w)}),u(c),m(s,o)};O(E,s=>{r().length>0&&s(G)})}u(I),b(()=>x.disabled=!(r().length>0&&!f())),m(e,k),P()}T(["click"]);export{Ke as component,Ge as universal};
