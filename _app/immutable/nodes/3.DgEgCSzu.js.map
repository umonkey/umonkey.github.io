{"version":3,"file":"3.DgEgCSzu.js","sources":["../../../../../../node_modules/svelte/src/internal/client/dom/blocks/await.js","../../../../../../src/routes/map/+page.ts?sentry-auto-wrap","../../../../../../src/routes/map/+page.ts","../../../../../../src/lib/components/map/GalleryPreview.svelte","../../../../../../src/lib/components/map/MapPreview.svelte","../../../../../../src/lib/constants.ts","../../../../../../src/lib/stores/map.ts","../../../../../../src/routes/map/+page.svelte"],"sourcesContent":["/** @import { Effect, Source, TemplateNode } from '#client' */\nimport { DEV } from 'esm-env';\nimport { is_promise } from '../../../shared/utils.js';\nimport { block, branch, pause_effect, resume_effect } from '../../reactivity/effects.js';\nimport { internal_set, mutable_source, source } from '../../reactivity/sources.js';\nimport {\n\tcomponent_context,\n\tflush_sync,\n\tis_runes,\n\tset_active_effect,\n\tset_active_reaction,\n\tset_component_context,\n\tset_dev_current_component_function\n} from '../../runtime.js';\nimport { hydrate_next, hydrate_node, hydrating } from '../hydration.js';\nimport { queue_micro_task } from '../task.js';\nimport { UNINITIALIZED } from '../../../../constants.js';\n\nconst PENDING = 0;\nconst THEN = 1;\nconst CATCH = 2;\n\n/**\n * @template V\n * @param {TemplateNode} node\n * @param {(() => Promise<V>)} get_input\n * @param {null | ((anchor: Node) => void)} pending_fn\n * @param {null | ((anchor: Node, value: Source<V>) => void)} then_fn\n * @param {null | ((anchor: Node, error: unknown) => void)} catch_fn\n * @returns {void}\n */\nexport function await_block(node, get_input, pending_fn, then_fn, catch_fn) {\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\tvar anchor = node;\n\tvar runes = is_runes();\n\tvar active_component_context = component_context;\n\n\t/** @type {any} */\n\tvar component_function = DEV ? component_context?.function : null;\n\n\t/** @type {V | Promise<V> | typeof UNINITIALIZED} */\n\tvar input = UNINITIALIZED;\n\n\t/** @type {Effect | null} */\n\tvar pending_effect;\n\n\t/** @type {Effect | null} */\n\tvar then_effect;\n\n\t/** @type {Effect | null} */\n\tvar catch_effect;\n\n\tvar input_source = (runes ? source : mutable_source)(/** @type {V} */ (undefined));\n\tvar error_source = (runes ? source : mutable_source)(undefined);\n\tvar resolved = false;\n\n\t/**\n\t * @param {PENDING | THEN | CATCH} state\n\t * @param {boolean} restore\n\t */\n\tfunction update(state, restore) {\n\t\tresolved = true;\n\n\t\tif (restore) {\n\t\t\tset_active_effect(effect);\n\t\t\tset_active_reaction(effect); // TODO do we need both?\n\t\t\tset_component_context(active_component_context);\n\t\t\tif (DEV) set_dev_current_component_function(component_function);\n\t\t}\n\n\t\ttry {\n\t\t\tif (state === PENDING && pending_fn) {\n\t\t\t\tif (pending_effect) resume_effect(pending_effect);\n\t\t\t\telse pending_effect = branch(() => pending_fn(anchor));\n\t\t\t}\n\n\t\t\tif (state === THEN && then_fn) {\n\t\t\t\tif (then_effect) resume_effect(then_effect);\n\t\t\t\telse then_effect = branch(() => then_fn(anchor, input_source));\n\t\t\t}\n\n\t\t\tif (state === CATCH && catch_fn) {\n\t\t\t\tif (catch_effect) resume_effect(catch_effect);\n\t\t\t\telse catch_effect = branch(() => catch_fn(anchor, error_source));\n\t\t\t}\n\n\t\t\tif (state !== PENDING && pending_effect) {\n\t\t\t\tpause_effect(pending_effect, () => (pending_effect = null));\n\t\t\t}\n\n\t\t\tif (state !== THEN && then_effect) {\n\t\t\t\tpause_effect(then_effect, () => (then_effect = null));\n\t\t\t}\n\n\t\t\tif (state !== CATCH && catch_effect) {\n\t\t\t\tpause_effect(catch_effect, () => (catch_effect = null));\n\t\t\t}\n\t\t} finally {\n\t\t\tif (restore) {\n\t\t\t\tif (DEV) set_dev_current_component_function(null);\n\t\t\t\tset_component_context(null);\n\t\t\t\tset_active_reaction(null);\n\t\t\t\tset_active_effect(null);\n\n\t\t\t\t// without this, the DOM does not update until two ticks after the promise\n\t\t\t\t// resolves, which is unexpected behaviour (and somewhat irksome to test)\n\t\t\t\tflush_sync();\n\t\t\t}\n\t\t}\n\t}\n\n\tvar effect = block(() => {\n\t\tif (input === (input = get_input())) return;\n\n\t\tif (is_promise(input)) {\n\t\t\tvar promise = input;\n\n\t\t\tresolved = false;\n\n\t\t\tpromise.then(\n\t\t\t\t(value) => {\n\t\t\t\t\tif (promise !== input) return;\n\t\t\t\t\t// we technically could use `set` here since it's on the next microtick\n\t\t\t\t\t// but let's use internal_set for consistency and just to be safe\n\t\t\t\t\tinternal_set(input_source, value);\n\t\t\t\t\tupdate(THEN, true);\n\t\t\t\t},\n\t\t\t\t(error) => {\n\t\t\t\t\tif (promise !== input) return;\n\t\t\t\t\t// we technically could use `set` here since it's on the next microtick\n\t\t\t\t\t// but let's use internal_set for consistency and just to be safe\n\t\t\t\t\tinternal_set(error_source, error);\n\t\t\t\t\tupdate(CATCH, true);\n\t\t\t\t\tif (!catch_fn) {\n\t\t\t\t\t\t// Rethrow the error if no catch block exists\n\t\t\t\t\t\tthrow error_source.v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (hydrating) {\n\t\t\t\tif (pending_fn) {\n\t\t\t\t\tpending_effect = branch(() => pending_fn(anchor));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Wait a microtask before checking if we should show the pending state as\n\t\t\t\t// the promise might have resolved by the next microtask.\n\t\t\t\tqueue_micro_task(() => {\n\t\t\t\t\tif (!resolved) update(PENDING, true);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tinternal_set(input_source, input);\n\t\t\tupdate(THEN, false);\n\t\t}\n\n\t\t// Set the input to something else, in order to disable the promise callbacks\n\t\treturn () => (input = UNINITIALIZED);\n\t});\n\n\tif (hydrating) {\n\t\tanchor = hydrate_node;\n\t}\n}\n","import type { Load } from '@sveltejs/kit';\n\nexport const load: Load = ({\n\turl\n}): Promise<{\n\tsearchQuery: string | undefined;\n}> => {\n\tconst searchQuery = url.searchParams.get('q');\n\n\treturn {\n\t\tsearchQuery\n\t};\n};\n","import { wrapLoadWithSentry } from \"@sentry/sveltekit\";import * as userModule from \"/home/hex/src/umonkey/treemap/frontend-v2/src/routes/map/+page.ts?sentry-auto-wrap\";export const load = userModule.load ? wrapLoadWithSentry(userModule.load) : undefined;export * from \"/home/hex/src/umonkey/treemap/frontend-v2/src/routes/map/+page.ts?sentry-auto-wrap\";","<script>\n\timport { routes } from '$lib/routes';\n\timport { apiClient } from '$lib/api';\n\n\tconst { tree } = $props();\n</script>\n\n<div class=\"gallery\">\n\t{#await apiClient.getTree(tree.id) then res}\n\t\t{#if res.status != 200}\n\t\t\tFailed to load photos.\n\t\t{:else if res.data.files.length == 0}\n\t\t\tNo images for this tree.\n\t\t{:else}\n\t\t\t<div class=\"images\">\n\t\t\t\t{#each res.data.files as file}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a href={routes.treeDetails(tree.id)}>\n\t\t\t\t\t\t\t<img src={routes.file(file.small_id)} alt=\"See how good is this tree.\" />\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{/if}\n\t{/await}\n</div>\n\n<style>\n\t.gallery {\n\t\theight: 50px;\n\t\tline-height: 50px;\n\t\tmargin-top: var(--gap);\n\t}\n\n\t.images {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: var(--gap);\n\n\t\tscroll-snap-type: x mandatory;\n\t\tscrollbar-width: none;\n\n\t\ta {\n\t\t\tdisplay: block;\n\n\t\t\tscroll-snap-align: start;\n\t\t\tscroll-snap-stop: always;\n\n\t\t\timg {\n\t\t\t\tdisplay: block;\n\t\t\t\twidth: 50px;\n\t\t\t\theight: 50px;\n\t\t\t\tobject-position: center;\n\t\t\t\tobject-fit: cover;\n\t\t\t\toverflow: hidden;\n\t\t\t\tcolor: transparent; /* hide alt */\n\t\t\t}\n\t\t}\n\t}\n</style>\n","<script>\n\timport CloseIcon from '$lib/icons/CloseIcon.svelte';\n\timport GalleryPreview from '$lib/components/map/GalleryPreview.svelte';\n\timport { routes } from '$lib/routes';\n\timport { shortDetails } from '$lib/utils/trees';\n\n\texport let tree;\n\texport let onClose;\n</script>\n\n{#if tree}\n\t<div class=\"preview\">\n\t\t<div class=\"header\">\n\t\t\t<div class=\"title\"><a href={routes.treeDetails(tree.id)}>{tree.species}</a></div>\n\t\t\t<button class=\"close\" on:click={onClose}><CloseIcon /></button>\n\t\t</div>\n\t\t<div class=\"props\">{shortDetails(tree)}</div>\n\t\t<GalleryPreview {tree} />\n\t</div>\n{/if}\n\n<style>\n\t.preview {\n\t\tpadding: var(--gap);\n\t\tline-height: 1.5em;\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\n\t\t.title {\n\t\t\tflex-grow: 1;\n\t\t\tflex-shrink: 1;\n\t\t}\n\n\t\t.close {\n\t\t\tflex-basis: 30px;\n\t\t\tflex-grow: 0;\n\t\t\tflex-shrink: 0;\n\n\t\t\twidth: 30px;\n\t\t\theight: 30px;\n\t\t\tcursor: pointer;\n\n\t\t\tbackground-color: transparent;\n\t\t\tborder: none;\n\t\t\tcolor: var(--sep-color);\n\t\t}\n\t}\n\n\t@media (max-width: 480px) {\n\t\t.preview {\n\t\t\tposition: fixed;\n\t\t\tbottom: 0px;\n\n\t\t\tz-index: var(--z-map-preview);\n\n\t\t\twidth: 100%;\n\t\t\tbox-sizing: border-box;\n\t\t\tbackground-color: var(--form-background);\n\t\t\tborder-top-left-radius: 8px;\n\t\t\tborder-top-right-radius: 8px;\n\n\t\t\tpadding: var(--gap);\n\t\t}\n\t}\n</style>\n","export const DEFAULT_MAP_CENTER = [40.181389, 44.514444];\n","import { writable, derived } from 'svelte/store';\nimport { DEFAULT_MAP_CENTER } from '$lib/constants';\nimport { ls } from '$lib/utils/localStorage';\n\nexport const mapState = writable(\n\tls.read('mapState') || {\n\t\tcenter: DEFAULT_MAP_CENTER,\n\t\tzoom: 15\n\t}\n);\n\nmapState.subscribe((value) => {\n\tls.write('mapState', value);\n});\n\nexport const mapCenter = derived(mapState, ($mapState) => $mapState.center);\nexport const mapZoom = derived(mapState, ($mapState) => $mapState.zoom);\n","<script lang=\"ts\">\n\timport Header from '$lib/components/tree/Header.svelte';\n\timport Map from '$lib/components/Map.svelte';\n\timport MapPreview from '$lib/components/map/MapPreview.svelte';\n\timport { mapState, mapCenter, mapZoom } from '$lib/stores/map';\n\timport type { ITree } from '$lib/types';\n\n\tconst { data } = $props();\n\tconst searchQuery = data.searchQuery;\n\n\tlet selectedTree: ITree | undefined = $state();\n\n\tconst title = searchQuery ? `Map: ${searchQuery}` : 'Map';\n\n\tconst onChange = (tree: ITree) => {\n\t\tselectedTree = tree;\n\t};\n\n\tconst onClosePreview = () => {\n\t\tselectedTree = undefined;\n\t};\n\n\tconst onMove = (center: number[], zoom: number) => {\n\t\tmapState.set({\n\t\t\tcenter,\n\t\t\tzoom\n\t\t});\n\t};\n</script>\n\n<svelte:head>\n\t<title>Tree Map</title>\n</svelte:head>\n\n<Header {title} />\n\n<Map center={$mapCenter} zoom={$mapZoom} {onChange} {onMove} {searchQuery} />\n\n<MapPreview tree={selectedTree} onClose={onClosePreview} />\n"],"names":["PENDING","THEN","CATCH","await_block","node","get_input","pending_fn","then_fn","catch_fn","hydrating","hydrate_next","anchor","runes","is_runes","active_component_context","component_context","input","UNINITIALIZED","pending_effect","then_effect","catch_effect","input_source","source","mutable_source","error_source","resolved","update","state","restore","set_active_effect","effect","set_active_reaction","set_component_context","resume_effect","branch","pause_effect","flush_sync","block","is_promise","promise","value","internal_set","error","queue_micro_task","hydrate_node","load","url","userModule.load","wrapLoadWithSentry","$.await","apiClient","$$props","res","$.each","div_1","$.get","file","routes","$.template_effect","$.set_attribute","img","$$render","consequent_1","alternate","consequent","alternate_1","tree","$.prop","onClose","a","$.set_text","text_1","shortDetails","text","_a","$$args","DEFAULT_MAP_CENTER","mapState","writable","ls","mapCenter","derived","$mapState","mapZoom","searchQuery","selectedTree","$.state","title","onChange","$.set","onClosePreview","onMove","center","zoom","$mapCenter","$mapZoom"],"mappings":"+6CAkBA,MAAMA,EAAU,EACVC,EAAO,EACPC,EAAQ,EAWP,SAASC,GAAYC,EAAMC,EAAWC,EAAYC,EAASC,EAAU,CACvEC,GACHC,GAAc,EAGf,IAAIC,EAASP,EACTQ,EAAQC,GAAU,EAClBC,EAA2BC,GAM3BC,EAAQC,EAGRC,EAGAC,EAGAC,EAEAC,GAAgBT,EAAQU,EAASC,GAAkC,MAAW,EAC9EC,GAAgBZ,EAAQU,EAASC,GAAgB,MAAS,EAC1DE,EAAW,GAMf,SAASC,EAAOC,EAAOC,EAAS,CAC/BH,EAAW,GAEPG,IACHC,EAAkBC,CAAM,EACxBC,EAAoBD,CAAM,EAC1BE,EAAsBlB,CAAwB,GAI/C,GAAI,CACCa,IAAU3B,GAAWM,IACpBY,EAAgBe,EAAcf,CAAc,EAC3CA,EAAiBgB,EAAO,IAAM5B,EAAWK,CAAM,CAAC,GAGlDgB,IAAU1B,GAAQM,IACjBY,EAAac,EAAcd,CAAW,EACrCA,EAAce,EAAO,IAAM3B,EAAQI,EAAQU,CAAY,CAAC,GAG1DM,IAAUzB,GAASM,IAClBY,EAAca,EAAcb,CAAY,EACvCA,EAAec,EAAO,IAAM1B,EAASG,EAAQa,CAAY,CAAC,GAG5DG,IAAU3B,GAAWkB,GACxBiB,EAAajB,EAAgB,IAAOA,EAAiB,IAAK,EAGvDS,IAAU1B,GAAQkB,GACrBgB,EAAahB,EAAa,IAAOA,EAAc,IAAK,EAGjDQ,IAAUzB,GAASkB,GACtBe,EAAaf,EAAc,IAAOA,EAAe,IAAK,CAE1D,QAAY,CACLQ,IAEHI,EAAsB,IAAI,EAC1BD,EAAoB,IAAI,EACxBF,EAAkB,IAAI,EAItBO,GAAY,EAEhB,CACA,CAEC,IAAIN,EAASO,GAAM,IAAM,CACxB,GAAIrB,KAAWA,EAAQX,EAAS,GAEhC,IAAIiC,GAAWtB,CAAK,EAAG,CACtB,IAAIuB,EAAUvB,EAEdS,EAAW,GAEXc,EAAQ,KACNC,GAAU,CACND,IAAYvB,IAGhByB,EAAapB,EAAcmB,CAAK,EAChCd,EAAOzB,EAAM,EAAI,EACjB,EACAyC,GAAU,CACV,GAAIH,IAAYvB,EAGhB,MAAAyB,EAAajB,EAAckB,CAAK,EAChChB,EAAOxB,EAAO,EAAI,EAGXsB,EAAa,CAEzB,CACI,EAEGf,GAOHkC,GAAiB,IAAM,CACjBlB,GAAUC,EAAO1B,EAAS,EAAI,CACxC,CAAK,CAEL,MACGyC,EAAapB,EAAcL,CAAK,EAChCU,EAAOzB,EAAM,EAAK,EAInB,MAAO,IAAOe,EAAQC,EACxB,CAAE,EAEGR,IACHE,EAASiC,GAEX,CCpKO,MAAMC,GAAa,CAAC,CAC1B,IAAAC,CACD,KAKQ,CACN,YAHmBA,EAAI,aAAa,IAAI,GAAG,CAI5C,GCXoLD,GAAOE,GAAkBC,GAAmBD,EAAe,EAAI,2zBCQ3OE,GAAA7C,EAAA,IAAA8C,GAAU,QAAaC,EAAA,KAAA,EAAE,UAAOC,IAAG,sKAOjCC,GAAAC,EAAA,GAAA,IAAAC,EAAAH,CAAG,EAAC,KAAK,YAASI,IAAI,oCAElBC,EAAO,YAAWN,EAAA,KAAM,EAAE,CAAA,CAAA,cACxBO,EAAA,IAAAC,EAAAC,GAAA,MAAAH,EAAO,KAAKF,EAAAC,CAAI,EAAC,QAAQ,CAAA,CAAA,0CAP9BD,EAAAH,CAAG,EAAC,KAAK,MAAM,QAAU,EAACS,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,yBAF/BX,CAAG,EAAC,QAAU,IAAGS,EAAAG,CAAA,EAAAH,EAAAI,EAAA,EAAA,uRCHZC,EAAIC,EAAAhB,EAAA,OAAA,CAAA,EACJiB,EAAOD,EAAAhB,EAAA,UAAA,CAAA,mEAMYO,EAAA,IAAAC,EAAAU,EAAA,OAAAZ,EAAO,YAAYS,EAAI,EAAC,EAAE,CAAA,CAAA,qFAGnCR,EAAA,IAAAY,EAAAC,EAAAC,GAAaN,EAAI,CAAA,CAAA,CAAA,wDAHsBR,EAAA,IAAAY,EAAAG,EAAAP,IAAK,OAAO,CAAA,qCACtCQ,EAAAN,MAAA,MAAAM,EAAO,MAAA,KAAAC,qBAJrCT,EAAI,GAAAL,EAAAG,CAAA,eCVI,MAAAY,GAAqB,CAAC,UAAW,SAAS,ECI1CC,EAAWC,GACvBC,GAAG,KAAK,UAAU,GAAK,CACtB,OAAQH,GACR,KAAM,EAAA,CAER,EAEAC,EAAS,UAAWrC,GAAU,CAC1BuC,GAAA,MAAM,WAAYvC,CAAK,CAC3B,CAAC,EAEM,MAAMwC,GAAYC,GAAQJ,EAAWK,GAAcA,EAAU,MAAM,EAC7DC,GAAUF,GAAQJ,EAAWK,GAAcA,EAAU,IAAI,wHCR/DE,SAAmB,gBAErBC,EAA+BC,GAAA,MAAA,EAE7B,MAAAC,EAAQH,EAAsB,QAAAA,CAAW,GAAK,MAE9CI,EAAYtB,GAAW,CAC5BuB,EAAAJ,KAAenB,CAAI,CAAA,GAGdwB,EAAc,IAAA,CACnBD,EAAAJ,EAAe,MAAS,GAGnBM,EAAM,CAAIC,EAAkBC,IAAY,CAC7ChB,EAAS,IACR,CAAA,OAAAe,EACA,KAAAC,CAAA,CAAA,6GAWUC,EAAU,qBAAQC,EAAQ,8EAErBV,CAAY,WAAWK","x_google_ignoreList":[0]}